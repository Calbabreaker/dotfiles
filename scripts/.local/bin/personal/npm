#!/bin/bash

#
# Converts npm commands to pnpm for stuff that uses npm only
#

function path_remove {
    PATH=${PATH/":$1"/}
    PATH=${PATH/"$1:"/}
}

caller_cmd=$(ps -o comm= $PPID)

# if pnpm is calling this script or pnpm does not exist then use normal npm instead
if [ ! -z $FORCE_NPM ] || [ caller_cmd = "pnpm" ] || ! command -v pnpm > /dev/null; then
    path_remove $(dirname $0)
    npm ${@:1}
else
    # if installing package convert install or i to add 
    first_arg=$( [ ! -z $2 ] && [ "$1" = "install" ] || [ "$1" = "i" ] && echo add || echo $1 )
    rest_args=$(sed -E 's/--(yes|scope=.+)//g' <<< "${@:2}") # remove --yes and --scope
    pnpm $first_arg $rest_args
fi
